$(function() {
  var blue = 'rgb(54, 162, 235)';
  var gray = 'rgb(99, 99, 99)';

  <% @week_targets.each do |week_target| %>
    <% current_study_amount = @microposts.this_week_study_amount(week_target.book.id) %>
    <% progress_rate = current_study_amount * 100 / week_target.content %>

    var ctx = $('#achievementRateOfStudyAmount<%= week_target.id %>');
    new Chart(ctx, {
      type: 'doughnut',
      data: { 
        datasets: [{
          data: [<%= progress_rate %>, <%= 100 - progress_rate %>],
          backgroundColor: [blue, gray]
        }]
      },
      options: {
        cutoutPercentage: 65,
        legend: { display: false },
        responsive: false,
        title: { 
          display: true, 
          fontSize: 16, 
          text: "<%= week_target.book.name %>"
        },
        tooltips: { enabled: false },
      },
      plugins: [chartJsPluginCenterLabel]
    });
  <% end %>
});